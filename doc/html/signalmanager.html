<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Generic Target</title>
<link rel="stylesheet" href="core/design.css">

</head>
<body>
<header>
<div class="header_title">Generic Target</div>
<div class="header_version">Version 20210202</div>
</header>
<button onclick="PageToTop()" id="buttonToTop"></button>
<div class="wrapper">
<div class="navigation">
<ul class="ulnav">
<li class="linone"></li>
<li class="linav"><a href="index.html">Overview</a></li>
<li class="linone"></li>
<li class="litext">GETTING STARTED</li>
<li class="linav"><a href="installtoolbox.html">Install Generic Target Toolbox</a></li>
<li class="linav"><a href="preparetarget.html">Prepare Target Computer</a></li>
<li class="linav"><a href="createanddeploy.html">Create and Deploy a Model</a></li>
<li class="linone"></li>
<li class="litext">HOW THE APPLICATION WORKS</li>
<li class="linav"><a href="application.html">Application Overview</a></li>
<li class="linav"><a href="udpobjectmanager.html">UDP Object Manager</a></li>
<li class="linav"><a href="multicastudpobjectmanager.html">Multicast UDP Object Manager</a></li>
<li class="linav_active"><a href="signalmanager.html">Signal Manager</a></li>
<li class="linone"></li>
<li class="linav"><a href="textlog.html">Text Log</a></li>
<li class="linav"><a href="simulinkinterface.html">Autogenerated Interface Class</a></li>
<li class="linav"><a href="threads.html">Thread Overview</a></li>
<li class="linav"><a href="timingscheduling.html">Timing & Scheduling</a></li>
<li class="linone"></li>
<li class="litext">HOW THE DEPLOYMENT WORKS</li>
<li class="linav"><a href="buildoverview.html">Overview</a></li>
<li class="linav"><a href="buildanddeploy.html">Deployment Process</a></li>
<li class="linav"><a href="framework.html">Target Software Directory</a></li>
</ul>

</div>
<div class="content">
<h1>Signal Manager</h1>
    The SignalManager manages the data recording of Simulink signals.
    Signals can be recorded as N-by-1 vectors of data type double.
    The data to be recorded are automatically written to files.
    These files are only successfully completed when the application is successfully closed or an autosave event is triggered.
    Each signal object has a unique ID. Internally the SignalManager has a hash table (<code>std::unordered_map</code>).
    In this hash table all signal objects are stored with their unique ID as key value.

    <h3>Initialization</h3>
    During the initialization phase, the start callback functions are called from Log To File blocks.
    These blocks register a signal object at the SignalManager.
    During registration the following parameters are passed.
    <table>
		<tr><th>Parameter</th><th>Description</th></tr>
		<tr><td>id</td><td>
            The unique ID of the signal object.</td></tr>
        <tr><td>numSignals</td><td>
            The number of signals to be recorded. This refers to the dimension of the signal.
            </td></tr>
        <tr><td>labels</td><td>
            A string with which signal names can be specified.
            The signal names of a multidimensional signal are separated by commas.
            These signal names are only used when the data is downloaded from the target PC to create named structures of timeseries.
            </td></tr>
	</table>

    <h3>Termination</h3>
    During the termination phase, open log files are closed.
    Then the SignalManager creates an index file in the corresponding log directory.
    This index file contains information about the data recording, like signal names.
    At the same time this index file indicates which files were created during data recording.

<h2>Data Logging</h2>
    As soon as the SignalManager is created, all signal objects are created.
    Afterwards no further signal objects can be registered.
    Each signal object has its own thread, which is responsible for writing to the file.
    The priority of the thread is defined by the Simulink interface class parameter <code><a href="simulinkinterface.html">priorityLog</a></code>.
    Data is not written continuously to the file.
    The Log To File block appends the values to be written to a queue.
    Only if the queue contains more than 65535 bytes, the bytes in the queue are written to the file by the thread.
    Then the queue is cleared again.
    For data recording the following parameters are passed to the SignalManager.
    <table>
		<tr><th>Parameter</th><th>Description</th></tr>
		<tr><td>id</td><td>
            The unique ID of the signal object that was registered during the initialization phase.
            </td></tr>
        <tr><td>values</td><td>
            An array of values to write. The data type is double.
            </td></tr>
        <tr><td>numValues</td><td>
            Number of values to be written.
            </td></tr>
	</table>

<a name="protocol"></a>
<h2>File Format</h2>
    A signal corresponds to a value of the data type double (8 bytes).
    The maximum file size is limited by software to 1 GB (1073741824 bytes).
    This corresponds to 134217728 values of the data type double.
    The values are written directly into a binary file (with the byte order of the target computer, i.e. little or big endian).
    If an N-by-1 vector of signals is recorded, all elements of the vector are written to the file one after the other.
    A timestamp of the data type double is added before each N-by-1 vector.
    The timestamp corresponds to the <a href="timingscheduling.html">model time</a>.
    After 134217728 values the current file is closed and a new log file is created.

    <h3>File Name</h3>
    The name of a log file always corresponds to the format <code><b>ID</b>_<b>NUM</b></code>, where <code><b>ID</b></code> is the ID of the signal object and <code><b>NUM</b></code> is the file number.
    The file 7_0 thus contains the recorded double values of ID 7.
    0 indicates that this is the first file.
    If this file has reached its maximum size or an autosave event has been triggered, the next file is created with the name 7_1.

    <h3>The index File</h3>
    The index file is written during the termination phase and indicates which log files exist, what the signal dimensions and sampling rates are, and the byte order in which the double values were written to the corresponding log files.
    The index file has the following format:
    <table>
		<tr>
            <th width="110px">Offset (Bytes)</th>
            <th width="110px">Length (Bytes)</th>
            <th width="180px">Name</th>
            <th width="120px">Data Type</th>
            <th>Description</th>
        </tr>
		<tr>
            <td style="font-family: Courier New;">0</td>
            <td style="font-family: Courier New;">5</td>
            <td style="font-family: Courier New;">header</td>
            <td style="font-family: Courier New;">5x uint8_t</td>
            <td>Header identifier: contains the string "GTLOG" (<code>0x47 0x54 0x4C 0x4F 0x47</code>).</td>
        </tr>
        <tr>
            <td style="font-family: Courier New;">5</td>
            <td style="font-family: Courier New;">1</td>
            <td style="font-family: Courier New;">endian</td>
            <td style="font-family: Courier New;">uint8_t</td>
            <td>Specifies the byte order. <code>0x01</code>: little endian, <code>0x80</code>: big endian. This byte order is used for all subsequent values as well as for all associated log files.</td>
        </tr>
        <tr>
            <td style="font-family: Courier New;">6</td>
            <td style="font-family: Courier New;">4</td>
            <td style="font-family: Courier New;">numObjects</td>
            <td style="font-family: Courier New;">uint32_t</td>
            <td>Number of signal objects (corresponds to the number of Log To File blocks in the Simulink model).</td>
        </tr>
        <tr>
            <td style="font-family: Courier New;">10</td>
            <td style="font-family: Courier New;"></td>
            <td style="font-family: Courier New;"><b>SignalObjectData</b></td>
            <td style="font-family: Courier New;"></td>
            <td>Contains <span style="font-family: Courier New;">numObjects</span> signal objekte. The data format for a signal object is shown in the following table.</td>
        </tr>
    </table>
    Data format for a signal object in the index file:
    <table>
		<tr>
            <th width="110px">Offset (Bytes)</th>
            <th width="110px">Length (Bytes)</th>
            <th width="180px">Name</th>
            <th width="120px">Data Type</th>
            <th>Description</th>
        </tr>
		<tr>
            <td style="font-family: Courier New;">0</td>
            <td style="font-family: Courier New;">4</td>
            <td style="font-family: Courier New;">ID</td>
            <td style="font-family: Courier New;">uint32_t</td>
            <td>Unique ID of the signal object.</td>
        </tr>
		<tr>
            <td style="font-family: Courier New;">4</td>
            <td style="font-family: Courier New;">4</td>
            <td style="font-family: Courier New;">signalDimension</td>
            <td style="font-family: Courier New;">uint32_t</td>
            <td>The dimension of the recorded signal (the timestamp is not added to the dimension of the signal).</td>
        </tr>
		<tr>
            <td style="font-family: Courier New;">8</td>
            <td style="font-family: Courier New;">4</td>
            <td style="font-family: Courier New;">fileNumber</td>
            <td style="font-family: Courier New;">uint32_t</td>
            <td>The current file number. A data number always starts with 0.</td>
        </tr>
		<tr>
            <td style="font-family: Courier New;">12</td>
            <td style="font-family: Courier New;">N</td>
            <td style="font-family: Courier New;">labels</td>
            <td style="font-family: Courier New;">N x char</td>
            <td>Optional string specifying the signal names. The length can be zero.</td>
        </tr>
		<tr>
            <td style="font-family: Courier New;">12+N</td>
            <td style="font-family: Courier New;">1</td>
            <td style="font-family: Courier New;">zeroTerminator</td>
            <td style="font-family: Courier New;">uint8_t</td>
            <td>Zero-terminator for the preceding string. This value is always 0x00 and indicates the end of the string.</td>
        </tr>
    </table>

</div>
</div>
<script src="core/script.js"></script>
</body>
</html>
